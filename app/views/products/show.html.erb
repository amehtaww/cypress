<%= render partial: 'header_product', locals: { product: @product } %>
<div class="row">

  <div class = 'col-md-8'>
    <% product_status_values = get_product_status_values(@product) %>

    <table class="table table-condensed table-product-status">
      <thead>
        <tr>
          <td></td>
          <th scope="col" colspan="2">C1</th>
          <th scope="col">C2</th>
          <th scope="col" colspan="3">C3</th>
          <th scope="col" colspan="2">C4</th>
        </tr>
        <tr>
          <td></td>
          <th scope="col"><small>Manual</small></th>
          <th scope="col"><small>QRDA-I</small></th>
          <th scope="col"><small>QRDA-III</small></th>
          <th scope="col"><small>Manual</small></th>
          <th scope="col"><small>QRDA-I</small></th>
          <th scope="col"><small>QRDA-III</small></th>
          <th scope="col"><small>QRDA-I</small></th>
          <th scope="col"><small>QRDA-III</small></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th scope="row"><i aria-hidden="true" class="fa fa-fw fa-check"></i> Passing Tests</th>
          <% product_status_row(product_status_values, 'passing').each do |count| %>
            <% if count > 0 %>
              <td class="status-passing text-center"> <%= count %> </td>
            <% else %>
              <td></td>
            <% end %>
          <% end %>
        </tr>
        <tr>
          <th scope="row"><i aria-hidden="true" class="fa fa-fw fa-times"></i> Failing Tests</th>
          <% product_status_row(product_status_values, 'failing').each do |count| %>
            <% if count > 0 %>
              <td class="status-failing text-center"> <%= count %> </td>
            <% else %>
              <td></td>
            <% end %>
          <% end %>
        </tr>
        <tr>
          <th scope="row"><i aria-hidden="true" class="fa fa-fw fa-circle-o"></i> Unstarted Tests</th>
          <% product_status_row(product_status_values, 'not_started').each do |count| %>
            <% if count > 0 %>
              <td class="status-not-started text-center"> <%= count %> </td>
            <% else %>
              <td></td>
            <% end %>
          <% end %>
        </tr>
        <tr>
          <th scope="row"><i aria-hidden="true" class="fa fa-fw fa-exclamation"></i> Errors</th>
          <% product_status_row(product_status_values, 'errored').each do |count| %>
            <% if count > 0 %>
              <td class="status-errored text-center"> <%= count %> </td>
            <% else %>
              <td></td>
            <% end %>
          <% end %>
        </tr>
      </tbody>
    </table>
  </div>

  <div class = 'col-md-4'>
    <% unless @product.product_tests.empty? %>
      <div class = 'panel panel-default'>
        <div class = 'panel-heading'>
          <h1 class='panel-title'>Download Full Test Deck</h1>
        </div>
        <div class = 'panel-body' id = 'display_bulk_download'>
          <%= render partial: 'bulk_download', locals: { product: @product } %>
        </div>
      </div>
    <% end %>
  </div>
</div>


<div class="product-test-tabs">
  <ul>
    <% APP_CONFIG.tests.each do |test_type, test_info| %>
      <% if should_show_product_tests_tab?(@product, test_type) %>
        <li><a href="#<%= "#{test_type}" %>"><%= "#{test_info['title']}" %></a></li>
      <% end %>
    <% end %>
  </ul>

  <% APP_CONFIG.tests.each do |test_type, test_info| %>
    <% if should_show_product_tests_tab?(@product, test_type) %>
      <div id="<%= test_type %>">
        <p class = 'lead'><%= "#{test_info['description']} #{perform_c3_certification_during_measure_test_message(@product, test_type)}" %></p>

        <% if test_type == 'ChecklistTest' %>
          <% if @product.product_tests.checklist_tests.exists? %>
            <% checklist_test = @product.product_tests.checklist_tests.first %>
            <h1>
              Test Status
              <div class = 'inline-block pull-right'><%= button_to 'View Test', product_checklist_test_path(@product, checklist_test), class: 'btn btn-primary', method: :get %></div>
            </h1>
            <%= render partial: 'checklist_status_display', locals: { product: @product } %>
            <div id = 'display_checklist_execution_results'>
              <%= render partial: 'checklist_execution_results', locals: { execution: @product.product_tests.checklist_tests.first.tasks.c1_manual_task.most_recent_execution } %>
            </div>
          <% else %>
            <div class = 'inline-block'><%= button_to 'Start Test', product_checklist_tests_path(@product), class: 'btn btn-primary', method: :post %></div>
            <span>This test does not need to completed all at once. You can always come back once the test is started.</span>
          <% end %>

        <% elsif test_type == 'FilteringTest' %>
          <div id="display_filtering_test_status_display">
            <%= render partial: 'filtering_test_status_display', locals: { tests: @product.product_tests.filtering_tests } if @product.product_tests.filtering_tests.exists? %>
          </div>

        <% else %>
          <div id="display_measure_tests_table">
            <%= render partial: 'measure_tests_table', locals: { tests: @product.product_tests.measure_tests } %>
          </div>
        <% end %>
      </div>
    <% end %>
  <% end %>
</div>
